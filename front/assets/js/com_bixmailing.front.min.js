/*! com_bixmailing 01-02-2015 19:03:22 */
(function(t){"use strict";var e;jQuery&&UIkit&&(e=t(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixloadtemplate",["uikit"],function(){return e||t(jQuery,UIkit)})})(function(t,e){"use strict";return e.component("bixloadtemplate",{defaults:{view:"",layout:"",tpl:"",highlight:!1,ajaxUrl:"/index.php?option=com_bixmailing&format=raw"},boot:function(){e.ready(function(i){t("[data-bix-loadtemplate]",i).each(function(){var i=t(this);i.data("bixloadtemplate")||e.bixloadtemplate(i,e.Utils.options(i.attr("data-bix-loadtemplate")))})})},init:function(){var t=this;this.on("loadTemplate",function(){t.element.load(t.options.ajaxUrl,t.options,function(){t.options.highlight&&t.find("li:first-child").addClass("uk-animation-scale-down"),t.element.trigger("templateLoaded")})})}}),e.bixloadtemplate}),function(t,e){"use strict";var i="/index.php?option=com_bixmailing&format=raw&task=bixmailing.fileView";t.extend(e.BixTools.prototype,{download:function(n,s){if(-1!==["csv","txt"].indexOf(n.slice(-3))){var a=e.modal("#file-download-modal",{bgclose:!0});a.show(),a.find(".bix-download").attr("href","/download?h="+s).click(function(){a.hide()}),a.find(".bix-bekijk").click(function(){a.hide(),t("#file-contents").load(i+"&h="+s)}),a.find(".bix-mailings").click(function(){a.hide();var e=n.split("/"),i=e[e.length-1];window.location.href=t(this).data("base")+"?search=file:"+i})}else window.location.href="/download?h="+s}})}(jQuery,UIkit),jQuery(function(t){"use strict";t("#import-switcher").on("show.uk.switcher",function(e,i){var n=i.data("bix-content"),s=t("#"+n+"-records");s.find("> div:not(.bix-placeholder)").length||s.trigger("loadTemplate")})}),function(t,e){"use strict";e.components.bixupload&&t.extend(e.components.bixupload.prototype,{convertFiles:function(i,n){this.progressNotification.element.find(".bix-progress-text").text(this.options.lang.bezigConverteren),this.progressNotification.element.find(".bix-progress-stats").text(this.options.lang.tekstConverteren).prepend(t(e.bixTools.icon("cog")).addClass("uk-icon-spin")),this.progressNotification.element.find(".uk-progress").hide();var s=this,a=!1,o=0;t.each(n,function(i,n){var r=t('[data-filehash="'+n.hash+'"]'),l=-1!==["Gls","Postnl"].indexOf(n.type),u={hash:n.hash};a=l,l&&(r.append(s.createConvertMessage(n.type)),u.task="bixmailing.import"+n.type,o++,t.post(s.options.ajaxUrl,u,"","json").done(function(t){t.success&&(t.result.file.hash=t.result.file.url.slice(-32),r.find(".bix-convert-text").hide(),r.find(".bix-filelist").append(s.createFileInfo(t.result.file)),r.find(".bix-filebuttons").append(s.createFileButtons(n.type)),s.buttonEvents(r),s.showDataTab(n.type),o--),0===o&&(e.notify.closeAll(),s.progressNotification=!1)}).fail(function(){e.notify({message:s.options.lang.foutConversieRequest,status:"danger"})}).always(function(t){t.messages&&e.bixTools.showNotifications(t.messages)}))}),a||(e.notify.closeAll(),e.notify({message:this.options.lang.noValidFiles,status:"danger"}))},buttonEvents:function(i){var n=this;i.find(".bix-mailfiles").click(function(){var n=i.find("[data-bix-fileinfo]").map(function(){return e.Utils.options(t(this).data("bix-fileinfo"))}).get();t("#mail-modal").data("bixmailfiles").sendFiles(n)}),i.find(".bix-filedetails").click(function(){var e=t(this);e.hasClass("uk-active")||(n.element.find("button").removeClass("uk-active"),e.addClass("uk-active"),n.showDataTab(e.data("type")))})},showDataTab:function(e){t("#"+e.toLowerCase()+"-records").empty();var i="Postnl"===e?1:0;t("#import-switcher").data("switcher").show(i)},createFileButtons:function(t){var e=this;return'<div class="bix-filebuttons"><button class="bix-mailfiles uk-button uk-width-1-1" type="button"><i class="uk-icon-paperclip uk-margin-small-right"></i>'+e.options.lang.mailfiles+"</button>"+'<button class="bix-filedetails uk-button uk-button-primary uk-margin-small-top uk-width-1-1" type="button" data-type="'+t+'">'+'<i class="uk-icon-search uk-margin-small-right"></i>'+e.options.lang.bekijkdata+"</button>"+"</div>"},createConvertMessage:function(t){var e=this;return'<div class="bix-convert-text uk-width-1-1 uk-margin-small-top uk-margin-small-bottom"><em>'+e.options.lang.converting[t]+"</em></div>"}})}(jQuery,UIkit),function(t){"use strict";var e;jQuery&&UIkit&&(e=t(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixuploadcontrols",["uikit"],function(){return e||t(jQuery,UIkit)})}(function(t,e){"use strict";return e.component("bixuploadcontrols",{defaults:{vervoerder:"",ajaxUrl:"/index.php?option=com_bixmailing&format=raw&task=bixmailing.sendMail"},boot:function(){e.ready(function(i){t("[data-bix-uploadcontrols]",i).each(function(){var i=t(this);i.data("bixuploadcontrols")||e.bixuploadcontrols(i,e.Utils.options(i.attr("data-bix-uploadcontrols")))})})},init:function(){var e=this;this.dataContainer=t("#"+this.options.vervoerder+"-records"),this.dom={button:this.find("button.bix-sendmails"),nrOpenMailings:t('[data-bix-openmailings="'+this.options.vervoerder+'"]'),nrIncomplMailings:t('[data-bix-incompleet="'+this.options.vervoerder+'"]'),nrKlanten:this.find('[data-bix-nrklanten="'+this.options.vervoerder+'"]'),nrMails:this.find('[data-bix-nrmails="'+this.options.vervoerder+'"]'),nrMailingMails:this.find('[data-bix-nrmailingmail="'+this.options.vervoerder+'"]')},this.dom.button.click(function(){e.sendMails()}),this.dataContainer.find("> div:not(.bix-placeholder)").length&&this.process()},process:function(){this.nrOpenMailings=this.dataContainer?this.dataContainer.find('[data-bix-mailing-status="nieuw"]').length:0,this.nrIncomplMailings=this.dataContainer?this.dataContainer.find('[data-bix-mailing-status="incompleet"]').length:0,this.nrKlanten=this.dataContainer?this.dataContainer.find("[data-bix-klantcontrols]").length:0,this.nrMails=this.dataContainer?this.dataContainer.find('[name="klantmailer[]"]:checked').length:0,this.nrMailingMails=this.dataContainer?this.dataContainer.find('[name="mailing[]"]:checked').length:0,this.updateDom()},updateDom:function(){this.dom.nrOpenMailings.text(this.nrOpenMailings),this.dom.nrIncomplMailings.text(this.nrIncomplMailings),this.dom.nrKlanten.text(this.nrKlanten),this.dom.nrMails.text(this.nrMails),this.dom.nrMailingMails.text(this.nrMailingMails)},sendMails:function(){var i=this,n=t("#"+i.options.vervoerder.toLowerCase()+"-records"),s={vervoerder:this.options.vervoerder,maildata:t("[data-bix-klantcontrols*="+this.options.vervoerder+"]").map(function(){return t(this).data("bixklantcontrols").getData()}).get()};n.bind("templateLoaded",function(){console.log(i),i.process()}),this.dom.button.find("i").addClass("uk-icon-spin"),t.post(this.options.ajaxUrl,s,"","json").done(function(t){console.log(t),t.success&&e.notify({message:t.result.length+" e-mails verzonden",status:"success"}),n.trigger("loadTemplate")}).fail(function(){e.notify({message:"Fout in request",status:"danger"})}).always(function(t){i.dom.button.find("i").removeClass("uk-icon-spin"),e.bixTools.showNotifications(t.messages)})}}),e.bixuploadcontrols}),function(t){"use strict";var e;jQuery&&UIkit&&(e=t(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixloadnext",["uikit"],function(){return e||t(jQuery,UIkit)})}(function(t,e){"use strict";return e.component("bixloadnext",{defaults:{ajaxUrl:"/index.php?option=com_bixmailing&format=raw",view:"bixmailing",part:"",filter:"",totalCount:0,extraStart:5,limit:5,lang:{meerLaden:"Meer items inladen...",lastReached:"Laatste item bereikt"}},boot:function(){e.ready(function(i){t("[data-bix-loadnext]",i).each(function(){var i=t(this);i.data("bixloadnext")||e.bixloadnext(i,e.Utils.options(i.attr("data-bix-loadnext")))})})},init:function(){var e=this;this.limitstart=this.options.extraStart,this.options.filter&&(this.filter=t(this.options.filter),this.filter.find("input").keyup(function(){e.loadNew(!0)})),this.setButton(),this.on("click",".bix-loadnext",function(){e.loadNew(!1)})},loadNew:function(i){var n=this,s={view:this.options.view,part:this.options.part,limit:this.options.limit,limitstart:0};this.limitstart=i?0:this.limitstart+this.options.limit,s.limitstart=this.limitstart,this.filter&&this.filter.find("input").each(function(){var e=t(this);s[e.attr("name")]=e.val()}),this.find("i.uk-icon-refresh").addClass("uk-icon-spin"),t.post(this.options.ajaxUrl,s).done(function(t){i?n.element.empty():n.find(".bix-loadnext").remove(),n.element.append(t),n.setButton()}).fail(function(){e.notify({message:"Fout in request",status:"danger"})})},setButton:function(){this.options.totalCount-(this.limitstart+this.options.limit)>0?this.element.append(this.loadMoreTmpl()):this.limitstart>this.options.extraStart&&this.element.append(this.lastReachedTmpl())},loadMoreTmpl:function(){return'<li><a class="uk-button uk-button-small uk-text-center uk-width-1-1 bix-loadnext">'+e.bixTools.icon("refresh")+this.options.lang.meerLaden+"</a></li>"},lastReachedTmpl:function(){return'<li><div class="uk-alert uk-text-small uk-text-center">'+e.bixTools.icon("info")+this.options.lang.lastReached+"</div></li>"}}),e.bixloadnext}),function(t){"use strict";var e;jQuery&&UIkit&&(e=t(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixklantlist",["uikit"],function(){return e||t(jQuery,UIkit)})}(function(t,e){"use strict";return e.component("bixklantlist",{defaults:{ajaxUrl:"/index.php?option=com_bixmailing&format=raw",detailHeight:434,detailTemplate:"Maak template aan"},boot:function(){e.ready(function(i){t("[data-bix-klantlist]",i).each(function(){var i=t(this);i.data("bixklantlist")||e.bixklantlist(i,e.Utils.options(i.attr("data-bix-klantlist")))})})},init:function(){var i=this;this.zoekRequest=!1,this.detailRequestId=!1,this.inviteRequest=!1,this.dom={searchbox:this.find("input[name=search]"),klantenList:this.find("ul.bix-klanten"),klantDetails:this.find(".bix-klantdetails")},this.dom.searchbox.prop("autocomplete","off").keyup(function(n){return-1!==[38,40].indexOf(n.keyCode)?(e.bixTools.navigateUl(i.dom.klantenList,n,!1),void 0):13===n.keyCode?(i.klantDetails(),void 0):(i.zoekKlanten(t(this).val()),void 0)}),this.klantdetailTemplate=t('script[type="text/klantdetailTemplate"]').text(),this.klantdetailTemplate=e.Utils.template(this.klantdetailTemplate||this.options.klantdetailTemplate),this.dom.klantenList.on("click","li",function(){i.dom.klantenList.find("li").removeClass("uk-active"),t(this).addClass("uk-active"),i.klantDetails()}),this.dom.klantDetails.on("click","button.bix-invite",function(){i.inviteKlant(t(this))}),this.zoekKlanten("")},inviteKlant:function(i,n){var s=this,a={};a.user_id=i.data("bix-userid"),a.force=n||0,a.task="klant.inviteUser",this.inviteRequest===!1&&(i.find("i").addClass("uk-icon-spin"),this.inviteRequest=t.getJSON(this.options.ajaxUrl,a).done(function(n){n.result.requireForce&&(s.find(".bix-force-button").html(t('<button type="button" data-bix-userid="'+a.user_id+'" class="uk-button uk-button-primary uk-button-small uk-margin-small-top">'+e.bixTools.icon("refresh")+n.result.forceText+"</button>").click(function(){s.inviteKlant(i,1)})),console.log(n)),n.success&&s.klantDetails()}).always(function(t){i.find("i").removeClass("uk-icon-spin"),s.inviteRequest=!1,e.bixTools.showNotifications(t.messages)}))},zoekKlanten:function(i){var n=this,s={};s.search=i,s.task="bixmailing.zoekKlanten",this.dom.klantenList.empty().append('<div class="uk-text-large uk-flex uk-flex-middle uk-flex-center" style="height:150px">'+e.bixTools.icon("spinner uk-icon-spin",!0)+"</div>"),this.zoekRequest!==!1&&this.zoekRequest.abort(),this.zoekRequest=t.getJSON(this.options.ajaxUrl,s).done(function(t){t.success&&(t.result.klanten.length?(n.dom.klantenList.empty().append(t.result.klanten.map(function(t){return'<li data-bix-userid="'+t.user_id+'" data-bix-klantnummer="'+t.klantnummer+'">'+'<a href="javascript:void(0)"><strong>'+t.bedrijfsnaam+"</strong><br/>"+t.klantnummer+" - "+t.adres+"</a></li>"})),n.klantDetails()):n.dom.klantenList.empty().append('<li class="uk-alert">Geen resultaten</li>'))}).always(function(t){n.zoekRequest=!1,e.bixTools.showNotifications(t.messages)})},klantDetails:function(){var i=this,n={task:"bixmailing.klantDetails"};0===this.dom.klantenList.find("li.uk-active").length&&this.dom.klantenList.find("li:first").addClass("uk-active"),n.userID=this.dom.klantenList.find("li.uk-active").data("bix-userid"),(this.detailRequestId===!1||n.userID!==this.detailRequestId)&&(this.detailRequestId=n.userID,this.dom.klantDetails.empty().append('<div class="uk-text-large uk-flex uk-flex-middle uk-flex-center" style="height:'+this.options.detailHeight+'px">'+e.bixTools.icon("spinner uk-icon-spin",!0)+"</div>"),t.getJSON(this.options.ajaxUrl,n).done(function(t){t.success?i.dom.klantDetails.html(i.klantdetailTemplate(t.result.profile)):i.dom.klantDetails.empty().append('<li class="uk-alert">Geen resultaten</li>')}).always(function(t){i.dom.klantDetails.find("div.uk-text-large.uk-flex").remove(),i.detailRequestId=!1,e.bixTools.showNotifications(t.messages)}))}}),e.bixklantlist}),function(t){"use strict";var e;jQuery&&UIkit&&(e=t(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixmailfiles",["uikit"],function(){return e||t(jQuery,UIkit)})}(function(t,e){"use strict";return e.component("bixmailfiles",{defaults:{ajaxUrl:"/index.php?option=com_bixmailing&format=raw&task=bixmailing.mailFiles"},boot:function(){e.ready(function(i){t("[data-bix-mailfiles]",i).each(function(){var i=t(this);i.data("bixmailfiles")||e.bixmailfiles(i,e.Utils.options(i.attr("data-bix-mailfiles")))})})},init:function(){var t=this;this.dom={email:this.find("[name=email]"),onderwerp:this.find("[name=onderwerp]"),tekst:this.find("[name=tekst]"),submit:this.find(".bix-submit"),fileList:this.find("ul.bix-files")},this.UImodal=e.modal(this.element),this.dom.submit.click(function(){t.submitform()}),this.files={}},sendFiles:function(i){var n=this;this.dom.fileList.empty(),t.each(i,function(t,i){n.files[i.hash]=i,n.dom.fileList.append("<li>"+e.bixTools.icon("paperclip")+i.name+"<br/>"+"<small>"+e.bixTools.formatFileSize(i.size)+"</small></li>")}),this.UImodal.isActive()&&this.UImodal.hide(),this.UImodal.show()},submitform:function(){var i=this,n={maildata:{email:this.dom.email.val(),onderwerp:this.dom.onderwerp.val(),tekst:this.dom.tekst.val()},files:[]};t.each(this.files,function(t,e){n.files.push(e.hash)}),i.dom.submit.find("i").addClass("uk-icon-spin"),t.post(this.options.ajaxUrl,n,"","json").done(function(t){console.log(i.UImodal),t.success&&i.UImodal.hide()}).fail(function(){e.notify({message:"Fout in request",status:"danger"})}).always(function(t){i.dom.submit.find("i").removeClass("uk-icon-spin"),e.bixTools.showNotifications(t.messages)})}}),e.bixmailfiles}),function(t){"use strict";var e;jQuery&&UIkit&&(e=t(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixmailingincompleet",["uikit"],function(){return e||t(jQuery,UIkit)})}(function(t,e){"use strict";return e.component("bixmailingincompleet",{defaults:{vervoerder:""},boot:function(){e.ready(function(i){t("[data-bix-mailing-incompleet]",i).each(function(){var i=t(this);i.data("bixmailingincompleet")||e.bixmailingincompleet(i,e.Utils.options(i.attr("data-bix-mailing-incompleet")))})})},init:function(){var i=this;this.klantrecords=t("[data-bix-klantrecords=0-"+this.options.vervoerder+"]");var n=t("#bix-selectuser-holder");this.selUser=e.bixselectuser(n,e.Utils.options(n.attr("data-bix-selectuser"))),this.klantrecords.find("[data-bix-selectuser-button]").click(function(){i.selUser.showForm(e.Utils.options(t(this).attr("data-bix-selectuser-button")))})}}),e.bixmailingincompleet}),function(t,e){"use strict";var i={geenBestanden:"Voeg eerst bestanden toe door ze in het venster te slepen"},n="bix-massamailform",s="/index.php?option=com_bixmailing&view=massamail&layout=confirm&format=raw";e.components.bixupload&&t.extend(e.components.bixupload.prototype,{massamail:function(i,n){this.progressNotification.close(),this.progressNotification=!1;var s=this,a=t("#bix-formfiles").empty();t.each(n,function(t,e){a.append(s.createFileFormList(e))}),e.notify({message:e.bixTools.icon("check")+this.options.lang.uploadDone,status:"success",timeout:4e3})},createFileFormList:function(t){return'<li class="bix-fileinfo" data-filehash="'+t.hash+'"><span class="uk-display-block uk-text-truncate uk-width-1-1" '+'title="'+t.name+'"><i class="uk-icon-paperclip uk-margin-small-right"></i>'+t.name+"</span>"+"</li>"}}),t(document).on("ready",function(){t("[data-bix-ajax-submit]").each(function(){var a=t(this),o=e.bixajaxsubmit(a,e.Utils.options(a.attr("data-bix-ajax-submit")));!a.attr("data-checkset")&&o&&a.attr("id")===n&&(o.validateForm=function(){var n=this,s=!0,a=t("#bix-formfiles");return a.find("li").length?(n.find("[name='jform[bestanden][]']").remove(),a.find("li").each(function(){var e=t(this).data("filehash");n.element.append('<input type="hidden" name="jform[bestanden][]" value="'+e+'" />')})):(e.notify({message:i.geenBestanden,status:"warning"}),s=!1),s},o.onSuccess=function(t){a.load(s+"&id="+t.id)},a.attr("data-checkset",!0))})})}(jQuery,UIkit),function(t){"use strict";var e;jQuery&&UIkit&&(e=t(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixselectuser",["uikit"],function(){return e||t(jQuery,UIkit)})}(function(t,e){"use strict";return e.component("bixselectuser",{defaults:{ajaxUrl:"/index.php?option=com_bixmailing&format=raw"},boot:function(){e.ready(function(i){t("[data-bix-selectuser-list]",i).each(function(){var i=t(this);i.data("bixselectuser")||e.bixselectuser(i,e.Utils.options(i.attr("data-bix-selectuser-list")))})})},init:function(){var i=this;this.state={mailingID:0,vervoerder:"",referentie:"",data:{}},this.activeRequest=!1,this.dom={modal:t("#selectuser-modal"),searchbox:this.find("input[name=search]"),button:this.find("button.bix-attachuser"),relatedList:this.find("ul.bix-related"),klantenList:this.find("ul.bix-klanten"),referentie:this.find("[data-bix-referentie]")},this.selUserModal=e.modal(this.dom.modal),this.dom.relatedList.on("click","li",function(){t(this).toggleClass("uk-active"),i.checkData()}),this.dom.searchbox.prop("autocomplete","off").keyup(function(n){return-1!==[38,40].indexOf(n.keyCode)?(e.bixTools.navigateUl(i.dom.klantenList,n,!1),void 0):13===n.keyCode?(i.checkData(),i.dom.button.attr("disabled")||i.attachUser(),void 0):(i.zoekKlanten(t(this).val()),void 0)}),t(document).bind("keyup","return",function(t){i.selUserModal.isActive()&&(t.preventDefault(),i.checkData(),i.dom.button.attr("disabled")||i.attachUser())}),this.dom.klantenList.on("click","li",function(){i.dom.klantenList.find("li").removeClass("uk-active"),t(this).addClass("uk-active"),i.checkData()}),this.dom.button.click(function(){i.attachUser()}),this.zoekKlanten("")},showForm:function(t){var e=this.state.referentie;this.state.mailingID=t.mailingID,this.state.vervoerder=t.vervoerder,this.state.referentie=t.referentie,this.state.referentie!==e&&this.relatedMailings(this.state),this.dom.referentie.text(this.state.referentie),this.dom.searchbox.val(""),this.zoekKlanten(""),this.selUserModal.isActive()&&this.selUserModal.hide(),this.selUserModal.show(),this.dom.searchbox.focus()},checkData:function(){return 0===this.dom.klantenList.find("li.uk-active").length&&this.dom.klantenList.find("li:first").addClass("uk-active"),this.state.data={referentie:this.state.referentie,vervoerder:this.state.vervoerder,mailingID:this.state.mailingID,mailingIDs:this.dom.relatedList.find("li.uk-active").map(function(){return t(this).data("bix-mailingid")}).get(),klantnummer:this.dom.klantenList.find("li.uk-active").map(function(){return t(this).data("bix-klantnummer")}).get().pop(),user_id:this.dom.klantenList.find("li.uk-active").map(function(){return t(this).data("bix-userid")}).get().pop()},this.dom.button.prop("disabled",!this.state.data.user_id||!this.state.data.mailingIDs.length),this.state.data},relatedMailings:function(i){var n=this;i.task="bixmailing.relatedMailings",this.dom.relatedList.empty(),t.getJSON(this.options.ajaxUrl,i).done(function(t){t.success&&t.result.related.length&&n.dom.relatedList.append(t.result.related.map(function(t){return'<li class="uk-active" data-bix-mailingid="'+t.id+'">'+'<a href="javascript:void(0)">'+t.naam+"<br/>"+t.type+"</a></li>"}))}).fail(function(){e.notify({message:"Fout in request mailings",status:"danger"})}).always(function(t){e.bixTools.showNotifications(t.messages)})},zoekKlanten:function(i){var n=this,s={};s.search=i,s.task="bixmailing.zoekKlanten",this.dom.klantenList.empty().append('<i class="uk-icon-spinner uk-icon-spin"></i>'),this.activeRequest!==!1&&this.activeRequest.abort(),this.activeRequest=t.getJSON(this.options.ajaxUrl,s).done(function(t){t.success&&(t.result.klanten.length?(n.dom.klantenList.empty().append(t.result.klanten.map(function(t){return'<li data-bix-userid="'+t.user_id+'" data-bix-klantnummer="'+t.klantnummer+'">'+'<a href="javascript:void(0)"><strong>'+t.bedrijfsnaam+"</strong><br/>"+t.klantnummer+" - "+t.adres+"</a></li>"})),n.checkData()):n.dom.klantenList.empty().append('<li class="uk-alert">Geen resultaten</li>'))}).always(function(t){e.bixTools.showNotifications(t.messages)})},attachUser:function(){var i=this,n=this.checkData();n.task="bixmailing.attachUser",t.post(this.options.ajaxUrl,n,"","json").done(function(e){e.success&&(i.selUserModal.hide(),t("#"+i.state.vervoerder.toLowerCase()+"-records").trigger("loadTemplate"))}).fail(function(){e.notify({message:"Fout in request klant koppelen",status:"danger"})}).always(function(t){e.bixTools.showNotifications(t.messages)})}}),e.bixselectuser}),function(t){"use strict";var e;jQuery&&UIkit&&(e=t(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixklantcontrols",["uikit"],function(){return e||t(jQuery,UIkit)})}(function(t,e){"use strict";return e.component("bixklantcontrols",{defaults:{klantnummer:0,vervoerder:"",togglerSel:".bix-toggler",openToggleIcon:"uk-icon-minus-square-o uk-icon-small",closedToggleIcon:"uk-icon-plus-square-o uk-icon-small",nrMailingsSel:".bix-nrmailings",nrActiveMailingsSel:".bix-nractivemailings"},boot:function(){e.ready(function(i){t("[data-bix-klantcontrols]",i).each(function(){var i=t(this);i.data("bixklantcontrols")||e.bixklantcontrols(i,e.Utils.options(i.attr("data-bix-klantcontrols")))})})},init:function(){var i,n=this;this.klantcontrol=this.element,this.klantrecords=t("[data-bix-klantrecords="+this.options.klantnummer+"-"+this.options.vervoerder+"]"),this.dom={klantmailer:this.find("input[name='klantmailer[]']"),mailingChecks:this.klantrecords.find("input[name='mailing[]']"),email:this.find("input[name='email']"),nrMailings:this.find(this.options.nrMailingsSel),nrActiveMailings:this.find(this.options.nrActiveMailingsSel)},this.find(this.options.togglerSel).click(function(){t(this).toggleClass("uk-active"),n.klantrecords.is(":hidden")?(t(this).find("i").attr("class",n.options.openToggleIcon),n.klantrecords.slideDown()):(t(this).find("i").attr("class",n.options.closedToggleIcon),n.klantrecords.slideUp())}),this.dom.klantmailer.click(function(){n.toggle(t(this))}),this.dom.mailingChecks.click(function(){n.process()}),i=t("#controls-"+this.options.vervoerder),this.uploadController=e.bixuploadcontrols(i,e.Utils.options(i.attr("data-bix-uploadcontrols"))),this.process()},toggle:function(t){this.dom.mailingChecks.prop("checked",t.is(":checked")),this.process()},process:function(){this.nrMailings=this.dom.mailingChecks.length,this.nrActiveMailings=this.dom.mailingChecks.filter(":checked").length,this.updateDom()},getData:function(){return{klantnummer:this.options.klantnummer,user_id:this.options.user_id,email:this.dom.email.val(),sendMailingIDs:this.dom.mailingChecks.filter(":checked").map(function(){return t(this).val()}).get(),mailingIDs:this.klantrecords.find("[name='mailingIDs[]']").map(function(){return t(this).val()}).get()}},updateDom:function(){this.dom.klantmailer.not(":checked")&&this.nrActiveMailings>0&&this.dom.klantmailer.prop("checked",!0),this.dom.nrMailings.text(this.nrMailings),this.dom.nrActiveMailings.text(this.nrActiveMailings),this.uploadController.process()}}),e.bixklantcontrols});
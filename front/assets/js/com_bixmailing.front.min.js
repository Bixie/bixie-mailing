/*! com_bixmailing 23-11-2016 11:26:18 */
!function(a){"use strict";var b;jQuery&&UIkit&&(b=a(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixloadtemplate",["uikit"],function(){return b||a(jQuery,UIkit)})}(function(a,b){"use strict";return b.component("bixloadtemplate",{defaults:{view:"",layout:"",tpl:"",highlight:!1,ajaxUrl:"/index.php?option=com_bixmailing&format=raw"},boot:function(){b.ready(function(c){a("[data-bix-loadtemplate]",c).each(function(){var c=a(this);c.data("bixloadtemplate")||b.bixloadtemplate(c,b.Utils.options(c.attr("data-bix-loadtemplate")))})})},init:function(){var a=this;this.on("loadTemplate",function(){a.element.load(a.options.ajaxUrl,a.options,function(){a.options.highlight&&a.find("li:first-child").addClass("uk-animation-scale-down"),a.element.trigger("templateLoaded")})})}}),b.bixloadtemplate}),function(a,b){"use strict";var c="/index.php?option=com_bixmailing&format=raw&task=bixmailing.fileView";a.extend(b.BixTools.prototype,{download:function(d,e){if(["csv","txt"].indexOf(d.slice(-3))!==-1){var f=b.modal("#file-download-modal",{bgclose:!0});f.show(),f.find(".bix-download").attr("href","/download?h="+e).click(function(){f.hide()}),f.find(".bix-bekijk").click(function(){f.hide(),a("#file-contents").load(c+"&h="+e)}),f.find(".bix-mailings").click(function(){f.hide();var b=d.split("/"),c=b[b.length-1];window.location.href=a(this).data("base")+"?search=file:"+c})}else window.location.href="/download?h="+e}})}(jQuery,UIkit),jQuery(function(a){"use strict";a("#import-switcher").on("show.uk.switcher",function(b,c){var d=c.data("bix-content"),e=a("#"+d+"-records");e.find("> div:not(.bix-placeholder)").length||e.trigger("loadTemplate")})}),function(a,b){"use strict";b.components.bixupload&&a.extend(b.components.bixupload.prototype,{convertFiles:function(c,d){this.progressNotification.element.find(".bix-progress-text").text(this.options.lang.bezigConverteren),this.progressNotification.element.find(".bix-progress-stats").text(this.options.lang.tekstConverteren).prepend(a(b.bixTools.icon("cog")).addClass("uk-icon-spin")),this.progressNotification.element.find(".uk-progress").hide();var e=this,f=!1,g=0;a.each(d,function(c,d){var h=a('[data-filehash="'+d.hash+'"]'),i=["Gls","Postnl","Parcelware"].indexOf(d.type)!==-1,j={hash:d.hash};f=i,i&&(h.append(e.createConvertMessage(d.type)),j.task="bixmailing.import"+d.type,g++,a.post(e.options.ajaxUrl,j,"","json").done(function(a){var c=d.type;a.success&&(a.result.file.hash=a.result.file.url.slice(-32),h.find(".bix-convert-text").hide(),h.find(".bix-filelist").append(e.createFileInfo(a.result.file)),"Parcelware"===d.type&&(c="Postnl"),h.find(".bix-filebuttons").append(e.createFileButtons(c)),e.buttonEvents(h),e.showDataTab(c),g--),0===g&&(b.notify.closeAll(),e.progressNotification=!1)}).fail(function(){b.notify({message:e.options.lang.foutConversieRequest,status:"danger"})}).always(function(a){a.messages&&b.bixTools.showNotifications(a.messages)}))}),f||(b.notify.closeAll(),b.notify({message:this.options.lang.noValidFiles,status:"danger"}))},buttonEvents:function(c){var d=this;c.find(".bix-mailfiles").click(function(){var d=c.find("[data-bix-fileinfo]").map(function(){return b.Utils.options(a(this).data("bix-fileinfo"))}).get();a("#mail-modal").data("bixmailfiles").sendFiles(d)}),c.find(".bix-filedetails").click(function(){var b=a(this);b.hasClass("uk-active")||(d.element.find("button").removeClass("uk-active"),b.addClass("uk-active"),d.showDataTab(b.data("type")))})},showDataTab:function(b){a("#"+b.toLowerCase()+"-records").empty();var c="Postnl"===b?1:0;a("#import-switcher").data("switcher").show(c)},createFileButtons:function(a){var b=this;return'<div class="bix-filebuttons"><button class="bix-mailfiles uk-button uk-width-1-1" type="button"><i class="uk-icon-paperclip uk-margin-small-right"></i>'+b.options.lang.mailfiles+'</button><button class="bix-filedetails uk-button uk-button-primary uk-margin-small-top uk-width-1-1" type="button" data-type="'+a+'"><i class="uk-icon-search uk-margin-small-right"></i>'+b.options.lang.bekijkdata+"</button></div>"},createConvertMessage:function(a){var b=this;return'<div class="bix-convert-text uk-width-1-1 uk-margin-small-top uk-margin-small-bottom"><em>'+b.options.lang.converting[a]+"</em></div>"}})}(jQuery,UIkit),function(a){"use strict";var b;jQuery&&UIkit&&(b=a(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixuploadcontrols",["uikit"],function(){return b||a(jQuery,UIkit)})}(function(a,b){"use strict";return b.component("bixuploadcontrols",{defaults:{vervoerder:"",ajaxUrl:"/index.php?option=com_bixmailing&format=raw&task=bixmailing.sendMail"},boot:function(){b.ready(function(c){a("[data-bix-uploadcontrols]",c).each(function(){var c=a(this);c.data("bixuploadcontrols")||b.bixuploadcontrols(c,b.Utils.options(c.attr("data-bix-uploadcontrols")))})})},init:function(){var b=this;this.dataContainer=a("#"+this.options.vervoerder+"-records"),this.dom={button:this.find("button.bix-sendmails"),nrOpenMailings:a('[data-bix-openmailings="'+this.options.vervoerder+'"]'),nrIncomplMailings:a('[data-bix-incompleet="'+this.options.vervoerder+'"]'),nrKlanten:this.find('[data-bix-nrklanten="'+this.options.vervoerder+'"]'),nrMails:this.find('[data-bix-nrmails="'+this.options.vervoerder+'"]'),nrMailingMails:this.find('[data-bix-nrmailingmail="'+this.options.vervoerder+'"]')},this.dom.button.click(function(){b.sendMails()}),this.dataContainer.find("> div:not(.bix-placeholder)").length&&this.process()},process:function(){this.nrOpenMailings=this.dataContainer?this.dataContainer.find('[data-bix-mailing-status="nieuw"]').length:0,this.nrIncomplMailings=this.dataContainer?this.dataContainer.find('[data-bix-mailing-status="incompleet"]').length:0,this.nrKlanten=this.dataContainer?this.dataContainer.find("[data-bix-klantcontrols]").length:0,this.nrMails=this.dataContainer?this.dataContainer.find('[name="klantmailer[]"]:checked').length:0,this.nrMailingMails=this.dataContainer?this.dataContainer.find('[name="mailing[]"]:checked').length:0,this.updateDom()},updateDom:function(){this.dom.nrOpenMailings.text(this.nrOpenMailings),this.dom.nrIncomplMailings.text(this.nrIncomplMailings),this.dom.nrKlanten.text(this.nrKlanten),this.dom.nrMails.text(this.nrMails),this.dom.nrMailingMails.text(this.nrMailingMails)},sendMails:function(){var c=this,d=a("#"+c.options.vervoerder.toLowerCase()+"-records"),e={vervoerder:this.options.vervoerder,maildata:a("[data-bix-klantcontrols*="+this.options.vervoerder+"]").map(function(){return a(this).data("bixklantcontrols").getData()}).get()};d.bind("templateLoaded",function(){console.log(c),c.process()}),this.dom.button.find("i").addClass("uk-icon-spin"),a.post(this.options.ajaxUrl,e,"","json").done(function(a){console.log(a),a.success&&b.notify({message:a.result.length+" e-mails verzonden",status:"success"}),d.trigger("loadTemplate")}).fail(function(){b.notify({message:"Fout in request",status:"danger"})}).always(function(a){c.dom.button.find("i").removeClass("uk-icon-spin"),b.bixTools.showNotifications(a.messages)})}}),b.bixuploadcontrols}),function(a){"use strict";var b;jQuery&&UIkit&&(b=a(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixloadnext",["uikit"],function(){return b||a(jQuery,UIkit)})}(function(a,b){"use strict";return b.component("bixloadnext",{defaults:{ajaxUrl:"/index.php?option=com_bixmailing&format=raw",view:"bixmailing",part:"",filter:"",totalCount:0,extraStart:5,limit:5,lang:{meerLaden:"Meer items inladen...",lastReached:"Laatste item bereikt"}},boot:function(){b.ready(function(c){a("[data-bix-loadnext]",c).each(function(){var c=a(this);c.data("bixloadnext")||b.bixloadnext(c,b.Utils.options(c.attr("data-bix-loadnext")))})})},init:function(){var b=this;this.limitstart=this.options.extraStart,this.options.filter&&(this.filter=a(this.options.filter),this.filter.find("input").keyup(function(){b.loadNew(!0)})),this.setButton(),this.on("click",".bix-loadnext",function(){b.loadNew(!1)})},loadNew:function(c){var d=this,e={view:this.options.view,part:this.options.part,limit:this.options.limit,limitstart:0};this.limitstart=c?0:this.limitstart+this.options.limit,e.limitstart=this.limitstart,this.filter&&this.filter.find("input").each(function(){var b=a(this);e[b.attr("name")]=b.val()}),this.find("i.uk-icon-refresh").addClass("uk-icon-spin"),a.post(this.options.ajaxUrl,e).done(function(a){c?d.element.empty():d.find(".bix-loadnext").remove(),d.element.append(a),d.setButton()}).fail(function(){b.notify({message:"Fout in request",status:"danger"})})},setButton:function(){this.options.totalCount-(this.limitstart+this.options.limit)>0?this.element.append(this.loadMoreTmpl()):this.limitstart>this.options.extraStart&&this.element.append(this.lastReachedTmpl())},loadMoreTmpl:function(){return'<li><a class="uk-button uk-button-small uk-text-center uk-width-1-1 bix-loadnext">'+b.bixTools.icon("refresh")+this.options.lang.meerLaden+"</a></li>"},lastReachedTmpl:function(){return'<li><div class="uk-alert uk-text-small uk-text-center">'+b.bixTools.icon("info")+this.options.lang.lastReached+"</div></li>"}}),b.bixloadnext}),function(a){"use strict";var b;jQuery&&UIkit&&(b=a(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixklantlist",["uikit"],function(){return b||a(jQuery,UIkit)})}(function(a,b){"use strict";return b.component("bixklantlist",{defaults:{ajaxUrl:"/index.php?option=com_bixmailing&format=raw",detailHeight:434,detailTemplate:"Maak template aan"},boot:function(){b.ready(function(c){a("[data-bix-klantlist]",c).each(function(){var c=a(this);c.data("bixklantlist")||b.bixklantlist(c,b.Utils.options(c.attr("data-bix-klantlist")))})})},init:function(){var c=this;this.zoekRequest=!1,this.detailRequestId=!1,this.inviteRequest=!1,this.dom={searchbox:this.find("input[name=search]"),klantenList:this.find("ul.bix-klanten"),klantDetails:this.find(".bix-klantdetails")},this.dom.searchbox.prop("autocomplete","off").keyup(function(d){return[38,40].indexOf(d.keyCode)!==-1?void b.bixTools.navigateUl(c.dom.klantenList,d,!1):13===d.keyCode?void c.klantDetails():void c.zoekKlanten(a(this).val())}),this.klantdetailTemplate=a('script[type="text/klantdetailTemplate"]').text(),this.klantdetailTemplate=b.Utils.template(this.klantdetailTemplate||this.options.klantdetailTemplate),this.dom.klantenList.on("click","li",function(){c.dom.klantenList.find("li").removeClass("uk-active"),a(this).addClass("uk-active"),c.klantDetails()}),this.dom.klantDetails.on("click","button.bix-invite",function(){c.inviteKlant(a(this))}),this.zoekKlanten("")},inviteKlant:function(c,d){var e=this,f={};f.user_id=c.data("bix-userid"),f.force=d||0,f.task="klant.inviteUser",this.inviteRequest===!1&&(c.find("i").addClass("uk-icon-spin"),this.inviteRequest=a.getJSON(this.options.ajaxUrl,f).done(function(d){d.result.requireForce&&(e.find(".bix-force-button").html(a('<button type="button" data-bix-userid="'+f.user_id+'" class="uk-button uk-button-primary uk-button-small uk-margin-small-top">'+b.bixTools.icon("refresh")+d.result.forceText+"</button>").click(function(){e.inviteKlant(c,1)})),console.log(d)),d.success&&e.klantDetails()}).always(function(a){c.find("i").removeClass("uk-icon-spin"),e.inviteRequest=!1,b.bixTools.showNotifications(a.messages)}))},zoekKlanten:function(c){var d=this,e={};e.search=c,e.task="bixmailing.zoekKlanten",this.dom.klantenList.empty().append('<div class="uk-text-large uk-flex uk-flex-middle uk-flex-center" style="height:150px">'+b.bixTools.icon("spinner uk-icon-spin",!0)+"</div>"),this.zoekRequest!==!1&&this.zoekRequest.abort(),this.zoekRequest=a.getJSON(this.options.ajaxUrl,e).done(function(a){a.success&&(a.result.klanten.length?(d.dom.klantenList.empty().append(a.result.klanten.map(function(a){return'<li data-bix-userid="'+a.user_id+'" data-bix-klantnummer="'+a.klantnummer+'"><a href="javascript:void(0)"><strong>'+a.bedrijfsnaam+"</strong><br/>"+a.klantnummer+" - "+a.adres+"</a></li>"})),d.klantDetails()):d.dom.klantenList.empty().append('<li class="uk-alert">Geen resultaten</li>'))}).always(function(a){d.zoekRequest=!1,b.bixTools.showNotifications(a.messages)})},klantDetails:function(){var c=this,d={task:"bixmailing.klantDetails"};0===this.dom.klantenList.find("li.uk-active").length&&this.dom.klantenList.find("li:first").addClass("uk-active"),d.userID=this.dom.klantenList.find("li.uk-active").data("bix-userid"),this.detailRequestId!==!1&&d.userID===this.detailRequestId||(this.detailRequestId=d.userID,this.dom.klantDetails.empty().append('<div class="uk-text-large uk-flex uk-flex-middle uk-flex-center" style="height:'+this.options.detailHeight+'px">'+b.bixTools.icon("spinner uk-icon-spin",!0)+"</div>"),a.getJSON(this.options.ajaxUrl,d).done(function(a){a.success?c.dom.klantDetails.html(c.klantdetailTemplate(a.result.profile)):c.dom.klantDetails.empty().append('<li class="uk-alert">Geen resultaten</li>')}).always(function(a){c.dom.klantDetails.find("div.uk-text-large.uk-flex").remove(),c.detailRequestId=!1,b.bixTools.showNotifications(a.messages)}))}}),b.bixklantlist}),function(a){"use strict";var b;jQuery&&UIkit&&(b=a(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixmailfiles",["uikit"],function(){return b||a(jQuery,UIkit)})}(function(a,b){"use strict";return b.component("bixmailfiles",{defaults:{ajaxUrl:"/index.php?option=com_bixmailing&format=raw&task=bixmailing.mailFiles"},boot:function(){b.ready(function(c){a("[data-bix-mailfiles]",c).each(function(){var c=a(this);c.data("bixmailfiles")||b.bixmailfiles(c,b.Utils.options(c.attr("data-bix-mailfiles")))})})},init:function(){var a=this;this.dom={email:this.find("[name=email]"),onderwerp:this.find("[name=onderwerp]"),tekst:this.find("[name=tekst]"),submit:this.find(".bix-submit"),fileList:this.find("ul.bix-files")},this.UImodal=b.modal(this.element),this.dom.submit.click(function(){a.submitform()}),this.files={}},sendFiles:function(c){var d=this;this.dom.fileList.empty(),a.each(c,function(a,c){d.files[c.hash]=c,d.dom.fileList.append("<li>"+b.bixTools.icon("paperclip")+c.name+"<br/><small>"+b.bixTools.formatFileSize(c.size)+"</small></li>")}),this.UImodal.isActive()&&this.UImodal.hide(),this.UImodal.show()},submitform:function(){var c=this,d={maildata:{email:this.dom.email.val(),onderwerp:this.dom.onderwerp.val(),tekst:this.dom.tekst.val()},files:[]};a.each(this.files,function(a,b){d.files.push(b.hash)}),c.dom.submit.find("i").addClass("uk-icon-spin"),a.post(this.options.ajaxUrl,d,"","json").done(function(a){console.log(c.UImodal),a.success&&c.UImodal.hide()}).fail(function(){b.notify({message:"Fout in request",status:"danger"})}).always(function(a){c.dom.submit.find("i").removeClass("uk-icon-spin"),b.bixTools.showNotifications(a.messages)})}}),b.bixmailfiles}),function(a){"use strict";var b;jQuery&&UIkit&&(b=a(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixmailingincompleet",["uikit"],function(){return b||a(jQuery,UIkit)})}(function(a,b){"use strict";return b.component("bixmailingincompleet",{defaults:{vervoerder:""},boot:function(){b.ready(function(c){a("[data-bix-mailing-incompleet]",c).each(function(){var c=a(this);c.data("bixmailingincompleet")||b.bixmailingincompleet(c,b.Utils.options(c.attr("data-bix-mailing-incompleet")))})})},init:function(){var c=this;this.klantrecords=a("[data-bix-klantrecords=0-"+this.options.vervoerder+"]");var d=a("#bix-selectuser-holder");this.selUser=b.bixselectuser(d,b.Utils.options(d.attr("data-bix-selectuser"))),this.klantrecords.find("[data-bix-selectuser-button]").click(function(){c.selUser.showForm(b.Utils.options(a(this).attr("data-bix-selectuser-button")))})}}),b.bixmailingincompleet}),function(a,b){"use strict";var c={geenBestanden:"Voeg eerst bestanden toe door ze in het venster te slepen"},d="bix-massamailform",e="/index.php?option=com_bixmailing&view=massamail&layout=confirm&format=raw";b.components.bixupload&&a.extend(b.components.bixupload.prototype,{massamail:function(c,d){this.progressNotification.close(),this.progressNotification=!1;var e=this,f=a("#bix-formfiles").empty();a.each(d,function(a,b){f.append(e.createFileFormList(b))}),b.notify({message:b.bixTools.icon("check")+this.options.lang.uploadDone,status:"success",timeout:4e3})},createFileFormList:function(a){return'<li class="bix-fileinfo" data-filehash="'+a.hash+'"><span class="uk-display-block uk-text-truncate uk-width-1-1" title="'+a.name+'"><i class="uk-icon-paperclip uk-margin-small-right"></i>'+a.name+"</span></li>"}}),a(document).on("ready",function(){a("[data-bix-ajax-submit]").each(function(){var f=a(this),g=b.bixajaxsubmit(f,b.Utils.options(f.attr("data-bix-ajax-submit")));!f.attr("data-checkset")&&g&&f.attr("id")===d&&(g.validateForm=function(){var d=this,e=!0,f=a("#bix-formfiles");return f.find("li").length?(d.find("[name='jform[bestanden][]']").remove(),f.find("li").each(function(){var b=a(this).data("filehash");d.element.append('<input type="hidden" name="jform[bestanden][]" value="'+b+'" />')})):(b.notify({message:c.geenBestanden,status:"warning"}),e=!1),e},g.onSuccess=function(a){f.load(e+"&id="+a.id)},f.attr("data-checkset",!0))})})}(jQuery,UIkit),function(a){"use strict";var b;jQuery&&UIkit&&(b=a(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixselectuser",["uikit"],function(){return b||a(jQuery,UIkit)})}(function(a,b){"use strict";return b.component("bixselectuser",{defaults:{ajaxUrl:"/index.php?option=com_bixmailing&format=raw"},boot:function(){b.ready(function(c){a("[data-bix-selectuser-list]",c).each(function(){var c=a(this);c.data("bixselectuser")||b.bixselectuser(c,b.Utils.options(c.attr("data-bix-selectuser-list")))})})},init:function(){var c=this;this.state={mailingID:0,vervoerder:"",referentie:"",data:{}},this.activeRequest=!1,this.dom={modal:a("#selectuser-modal"),searchbox:this.find("input[name=search]"),button:this.find("button.bix-attachuser"),relatedList:this.find("ul.bix-related"),klantenList:this.find("ul.bix-klanten"),referentie:this.find("[data-bix-referentie]")},this.selUserModal=b.modal(this.dom.modal),this.dom.relatedList.on("click","li",function(){a(this).toggleClass("uk-active"),c.checkData()}),this.dom.searchbox.prop("autocomplete","off").keyup(function(d){return[38,40].indexOf(d.keyCode)!==-1?void b.bixTools.navigateUl(c.dom.klantenList,d,!1):13===d.keyCode?(c.checkData(),void(c.dom.button.attr("disabled")||c.attachUser())):void c.zoekKlanten(a(this).val())}),a(document).bind("keyup","return",function(a){c.selUserModal.isActive()&&(a.preventDefault(),c.checkData(),c.dom.button.attr("disabled")||c.attachUser())}),this.dom.klantenList.on("click","li",function(){c.dom.klantenList.find("li").removeClass("uk-active"),a(this).addClass("uk-active"),c.checkData()}),this.dom.button.click(function(){c.attachUser()}),this.zoekKlanten("")},showForm:function(a){var b=this.state.referentie;this.state.mailingID=a.mailingID,this.state.vervoerder=a.vervoerder,this.state.referentie=a.referentie,this.state.referentie!==b&&this.relatedMailings(this.state),this.dom.referentie.text(this.state.referentie),this.dom.searchbox.val(""),this.zoekKlanten(""),this.selUserModal.isActive()&&this.selUserModal.hide(),this.selUserModal.show(),this.dom.searchbox.focus()},checkData:function(){return 0===this.dom.klantenList.find("li.uk-active").length&&this.dom.klantenList.find("li:first").addClass("uk-active"),this.state.data={referentie:this.state.referentie,vervoerder:this.state.vervoerder,mailingID:this.state.mailingID,mailingIDs:this.dom.relatedList.find("li.uk-active").map(function(){return a(this).data("bix-mailingid")}).get(),klantnummer:this.dom.klantenList.find("li.uk-active").map(function(){return a(this).data("bix-klantnummer")}).get().pop(),user_id:this.dom.klantenList.find("li.uk-active").map(function(){return a(this).data("bix-userid")}).get().pop()},this.dom.button.prop("disabled",!this.state.data.user_id||!this.state.data.mailingIDs.length),this.state.data},relatedMailings:function(c){var d=this;c.task="bixmailing.relatedMailings",this.dom.relatedList.empty(),a.getJSON(this.options.ajaxUrl,c).done(function(a){a.success&&a.result.related.length&&d.dom.relatedList.append(a.result.related.map(function(a){return'<li class="uk-active" data-bix-mailingid="'+a.id+'"><a href="javascript:void(0)">'+a.naam+"<br/>"+a.type+"</a></li>"}))}).fail(function(){b.notify({message:"Fout in request mailings",status:"danger"})}).always(function(a){b.bixTools.showNotifications(a.messages)})},zoekKlanten:function(c){var d=this,e={};e.search=c,e.task="bixmailing.zoekKlanten",this.dom.klantenList.empty().append('<i class="uk-icon-spinner uk-icon-spin"></i>'),this.activeRequest!==!1&&this.activeRequest.abort(),this.activeRequest=a.getJSON(this.options.ajaxUrl,e).done(function(a){a.success&&(a.result.klanten.length?(d.dom.klantenList.empty().append(a.result.klanten.map(function(a){return'<li data-bix-userid="'+a.user_id+'" data-bix-klantnummer="'+a.klantnummer+'"><a href="javascript:void(0)"><strong>'+a.bedrijfsnaam+"</strong><br/>"+a.klantnummer+" - "+a.adres+"</a></li>"})),d.checkData()):d.dom.klantenList.empty().append('<li class="uk-alert">Geen resultaten</li>'))}).always(function(a){b.bixTools.showNotifications(a.messages)})},attachUser:function(){var c=this,d=this.checkData();d.task="bixmailing.attachUser",a.post(this.options.ajaxUrl,d,"","json").done(function(b){b.success&&(c.selUserModal.hide(),a("#"+c.state.vervoerder.toLowerCase()+"-records").trigger("loadTemplate"))}).fail(function(){b.notify({message:"Fout in request klant koppelen",status:"danger"})}).always(function(a){b.bixTools.showNotifications(a.messages)})}}),b.bixselectuser}),function(a){"use strict";var b;jQuery&&UIkit&&(b=a(jQuery,UIkit)),"function"==typeof define&&define.amd&&define("uikit-bixklantcontrols",["uikit"],function(){return b||a(jQuery,UIkit)})}(function(a,b){"use strict";return b.component("bixklantcontrols",{defaults:{klantnummer:0,vervoerder:"",togglerSel:".bix-toggler",openToggleIcon:"uk-icon-minus-square-o uk-icon-small",closedToggleIcon:"uk-icon-plus-square-o uk-icon-small",nrMailingsSel:".bix-nrmailings",nrActiveMailingsSel:".bix-nractivemailings"},boot:function(){b.ready(function(c){a("[data-bix-klantcontrols]",c).each(function(){var c=a(this);c.data("bixklantcontrols")||b.bixklantcontrols(c,b.Utils.options(c.attr("data-bix-klantcontrols")))})})},init:function(){var c,d=this;this.klantcontrol=this.element,this.klantrecords=a("[data-bix-klantrecords="+this.options.klantnummer+"-"+this.options.vervoerder+"]"),this.dom={klantmailer:this.find("input[name='klantmailer[]']"),mailingChecks:this.klantrecords.find("input[name='mailing[]']"),email:this.find("input[name='email']"),nrMailings:this.find(this.options.nrMailingsSel),nrActiveMailings:this.find(this.options.nrActiveMailingsSel)},this.find(this.options.togglerSel).click(function(){a(this).toggleClass("uk-active"),d.klantrecords.is(":hidden")?(a(this).find("i").attr("class",d.options.openToggleIcon),d.klantrecords.slideDown()):(a(this).find("i").attr("class",d.options.closedToggleIcon),d.klantrecords.slideUp())}),this.dom.klantmailer.click(function(){d.toggle(a(this))}),this.dom.mailingChecks.click(function(){d.process()}),c=a("#controls-"+this.options.vervoerder),this.uploadController=b.bixuploadcontrols(c,b.Utils.options(c.attr("data-bix-uploadcontrols"))),this.process()},toggle:function(a){this.dom.mailingChecks.prop("checked",a.is(":checked")),this.process()},process:function(){this.nrMailings=this.dom.mailingChecks.length,this.nrActiveMailings=this.dom.mailingChecks.filter(":checked").length,this.updateDom()},getData:function(){return{klantnummer:this.options.klantnummer,user_id:this.options.user_id,email:this.dom.email.val(),sendMailingIDs:this.dom.mailingChecks.filter(":checked").map(function(){return a(this).val()}).get(),mailingIDs:this.klantrecords.find("[name='mailingIDs[]']").map(function(){return a(this).val()}).get()}},updateDom:function(){this.dom.klantmailer.not(":checked")&&this.nrActiveMailings>0&&this.dom.klantmailer.prop("checked",!0),this.dom.nrMailings.text(this.nrMailings),this.dom.nrActiveMailings.text(this.nrActiveMailings),this.uploadController.process()}}),b.bixklantcontrols});